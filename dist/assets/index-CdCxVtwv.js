(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const m of i.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&r(m)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}})();const l=document.getElementById("playerSelect"),c=document.getElementById("dateSelect"),f=document.getElementById("durationInput"),E=document.getElementById("activitySelect"),u=document.getElementById("submitButton"),I=document.getElementById("status"),B=document.getElementById("suggestionCard"),D=document.getElementById("suggestionMessage"),O=document.getElementById("suggestionAcceptButton"),T=document.getElementById("suggestionCancelButton"),A=document.getElementById("celebration"),N=document.getElementById("celebrationMessage"),g=document.getElementById("celebrationGif"),_=u.textContent;let p=null;const a=["https://media.giphy.com/media/xT9IgG50Fb7Mi0prBC/giphy.gif","https://media.giphy.com/media/12XDYvMJNcmLgQ/giphy.gif","https://media.tenor.com/1mwdqr51emcAAAAd/happy-dance.gif","https://media.tenor.com/yCFHzEvKa9MAAAAC/party-time.gif","https://media.tenor.com/2roX3uxz_68AAAAC/cat-space.gif","https://media.tenor.com/5ry-200hErMAAAAC/happy-dance-cat.gif","https://media.tenor.com/3x63SNMKPogAAAAC/minions-celebrate.gif","https://media.tenor.com/uUNcnHwYJQEAAAAC/rick-roll.gif"],P=[{maxScore:5,gif:a[0]},{maxScore:10,gif:a[1]},{maxScore:15,gif:a[2]},{maxScore:20,gif:a[3]},{maxScore:25,gif:a[4]},{maxScore:30,gif:a[5]},{maxScore:1/0,gif:a[6]}],S=P[0].gif;let y=0;function k(e){if(!Number.isFinite(e))return S;const t=P.find(o=>e<=o.maxScore);return t?t.gif:S}g.addEventListener("error",()=>{y=(y+1)%a.length;const e=a[y];g.src!==e&&(g.src=e)});function s(e,t=""){I.textContent=e||"",I.classList.remove("error","success"),t&&I.classList.add(t)}function C(){p=null,B.classList.add("hidden"),D.textContent=""}function J({message:e,suggestedDate:t,payload:o}){p={suggestedDate:t,payload:o},D.textContent=`You already have a score for this date. Want to add this score to ${x(t)} instead?`,B.classList.remove("hidden")}function v(e){u.disabled=e,u.textContent=e?"Saving...":_,O.disabled=e,T.disabled=e}function h(){A.classList.add("hidden"),A.classList.remove("big"),N.textContent="",g.src=S,y=a.indexOf(S)}function W({player:e,score:t}){const o=t==null||t===""?"(not ready yet)":t,r=Number(t),n=Number.isFinite(r)&&r>10,i=k(r);g.src=i,y=a.indexOf(i),A.classList.toggle("big",n),N.textContent=`Good job, ${e}! Your score is ${o}.`,A.classList.remove("hidden")}async function w(e,t={}){const o=await fetch(e,{headers:{"Content-Type":"application/json"},...t}),r=await o.text();let n={};if(r)try{n=JSON.parse(r)}catch{n={error:r}}if(!o.ok){const i=new Error(n.error||`Request failed (${o.status}).`);throw i.status=o.status,i.code=n.code,i.suggestion=n.suggestion,i}return n}function Y(e){let t=[...c.options].find(o=>o.value===e);t||(t=document.createElement("option"),t.value=e,t.textContent=x(e),c.prepend(t)),c.value=e}function $(e){C(),s(`Saved for ${e.player} on ${e.date} (row ${e.row}).`,"success"),W({player:e.player,score:e.score})}function L(e){return/^\d{1,3}:\d{2}$/.test(String(e).trim())}function b(){const e=l.value&&c.value&&L(f.value)&&E.value;u.disabled=!e}function M(e){const t=new Date(e);return t.setHours(0,0,0,0),t.toISOString().slice(0,10)}function x(e){const t=new Date(`${e}T00:00:00`);if(Number.isNaN(t.getTime()))return e;const o=t.toLocaleDateString(void 0,{weekday:"short"}),r=t.toLocaleDateString(void 0,{month:"short",day:"numeric"}),n=M(new Date);return e===n?`Today Â· ${o}, ${r}`:`${o}, ${r}`}function K(e){const t=[...new Set((e||[]).filter(Boolean))].sort((d,H)=>new Date(d).getTime()-new Date(H).getTime());if(!t.length)return{options:[],defaultDate:""};const o=M(new Date),r=t.filter(d=>d<=o),n=t.filter(d=>d>o),i=t.includes(o)?o:r[r.length-1]??t[0],m=r.slice(-5),G=n.slice(0,5),F=[i,...m.filter(d=>d!==i).reverse(),...G];return{options:[...new Set(F)].slice(0,10),defaultDate:i}}async function q(){s("Loading players..."),C(),h();const e=await w("/api/players"),t=await w("/api/dates?limit=90");if(!Array.isArray(e==null?void 0:e.players))throw new Error("Could not load players from API. Check your Azure Static Web App API configuration and environment variables.");if(!Array.isArray(e==null?void 0:e.activityOptions))throw new Error("Could not load activity options from API.");if(!Array.isArray(t==null?void 0:t.dates))throw new Error("Could not load dates from API.");l.innerHTML="",e.players.forEach((r,n)=>{const i=document.createElement("option");i.value=r.player,i.textContent=r.player,n===0&&(i.selected=!0),l.append(i)}),E.innerHTML="",e.activityOptions.forEach(r=>{const n=document.createElement("option");n.value=r,n.textContent=r,E.append(n)});const o=K(t.dates||[]);if(c.innerHTML="",o.options.forEach((r,n)=>{const i=document.createElement("option");i.value=r,i.textContent=x(r),(r===o.defaultDate||n===0)&&(i.selected=!0),c.append(i)}),!o.options.length){s("No existing date rows were found in the sheet.","error"),u.disabled=!0,l.disabled=!1,c.disabled=!0;return}l.disabled=!1,c.disabled=!1,u.disabled=!1,b(),s("Ready.")}async function z(){var t;C(),h();const e={player:l.value,date:c.value,duration:f.value.trim(),activity:E.value};if(!L(e.duration)){s("Duration must be in hh:mm format, for example 0:36.","error"),b();return}v(!0),s("Submitting...");try{const o=await w("/api/entry",{method:"POST",body:JSON.stringify(e)});$(o.result)}catch(o){o.code==="DATE_ALREADY_POPULATED"&&((t=o.suggestion)!=null&&t.date)?(J({message:o.message,suggestedDate:o.suggestion.date,payload:e}),s(""),h()):(s(o.message,"error"),h())}finally{v(!1),b()}}async function R(){if(!p)return;const e={...p.payload,date:p.suggestedDate};v(!0),s(`Submitting to ${x(e.date)}...`);try{const t=await w("/api/entry",{method:"POST",body:JSON.stringify(e)});Y(e.date),$(t.result)}catch(t){s(t.message,"error"),h()}finally{v(!1),b()}}function U(){C(),s("Suggestion dismissed. Choose a different date to continue.","error")}[l,c,f,E].forEach(e=>{e.addEventListener("input",()=>{e===f&&f.value&&!L(f.value)?s("Duration should look like hh:mm, example 0:36."):s(""),b()})});u.addEventListener("click",z);O.addEventListener("click",R);T.addEventListener("click",U);q().catch(e=>{s(e.message,"error")});
