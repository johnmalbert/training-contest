(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const m of r.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&i(m)}).observe(document,{childList:!0,subtree:!0});function o(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=o(n);fetch(n.href,r)}})();const l=document.getElementById("playerSelect"),c=document.getElementById("dateSelect"),f=document.getElementById("durationInput"),E=document.getElementById("activitySelect"),u=document.getElementById("submitButton"),I=document.getElementById("status"),D=document.getElementById("suggestionCard"),B=document.getElementById("suggestionMessage"),O=document.getElementById("suggestionAcceptButton"),T=document.getElementById("suggestionCancelButton"),b=document.getElementById("celebration"),N=document.getElementById("celebrationMessage"),g=document.getElementById("celebrationGif"),_=u.textContent;let p=null;const s=["https://media.giphy.com/media/xT9IgG50Fb7Mi0prBC/giphy.gif","https://media.giphy.com/media/12XDYvMJNcmLgQ/giphy.gif","https://media.tenor.com/1mwdqr51emcAAAAd/happy-dance.gif","https://media.tenor.com/yCFHzEvKa9MAAAAC/party-time.gif","https://media.tenor.com/2roX3uxz_68AAAAC/cat-space.gif","https://media.tenor.com/5ry-200hErMAAAAC/happy-dance-cat.gif","https://media.tenor.com/3x63SNMKPogAAAAC/minions-celebrate.gif","https://media.tenor.com/uUNcnHwYJQEAAAAC/rick-roll.gif"],$=[{maxScore:5,gif:s[0]},{maxScore:10,gif:s[1]},{maxScore:15,gif:s[2]},{maxScore:20,gif:s[3]},{maxScore:25,gif:s[4]},{maxScore:30,gif:s[5]},{maxScore:1/0,gif:s[6]}],A=$[0].gif;let y=0;function k(e){if(!Number.isFinite(e))return A;const t=$.find(o=>e<=o.maxScore);return t?t.gif:A}g.addEventListener("error",()=>{y=(y+1)%s.length;const e=s[y];g.src!==e&&(g.src=e)});function a(e,t=""){I.textContent=e||"",I.classList.remove("error","success"),t&&I.classList.add(t)}function C(){p=null,D.classList.add("hidden"),B.textContent=""}function H({message:e,suggestedDate:t,payload:o}){p={suggestedDate:t,payload:o},B.textContent=`You already have a score for this date. Want to add this score to ${x(t)} instead?`,D.classList.remove("hidden")}function v(e){u.disabled=e,u.textContent=e?"Saving...":_,O.disabled=e,T.disabled=e}function h(){b.classList.add("hidden"),b.classList.remove("big"),N.textContent="",g.src=A,y=s.indexOf(A)}function J({player:e,score:t}){const o=t==null||t===""?"(not ready yet)":t,i=Number(t),n=Number.isFinite(i)&&i>10,r=k(i);g.src=r,y=s.indexOf(r),b.classList.toggle("big",n),N.textContent=`Good job, ${e}! Your score is ${o}.`,b.classList.remove("hidden")}async function w(e,t={}){const o=await fetch(e,{headers:{"Content-Type":"application/json"},...t}),i=await o.text();let n={};if(i)try{n=JSON.parse(i)}catch{n={error:i}}if(!o.ok){const r=new Error(n.error||`Request failed (${o.status}).`);throw r.status=o.status,r.code=n.code,r.suggestion=n.suggestion,r}return n}function W(e){let t=[...c.options].find(o=>o.value===e);t||(t=document.createElement("option"),t.value=e,t.textContent=x(e),c.prepend(t)),c.value=e}function M(e){C(),a(`Saved for ${e.player} on ${e.date} (row ${e.row}).`,"success"),J({player:e.player,score:e.score})}function L(e){return/^\d{1,3}:\d{2}$/.test(String(e).trim())}function S(){const e=l.value&&c.value&&L(f.value)&&E.value;u.disabled=!e}function P(e){const t=new Date(e),o=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${o}-${i}-${n}`}function x(e){const t=new Date(`${e}T00:00:00`);if(Number.isNaN(t.getTime()))return e;const o=t.toLocaleDateString(void 0,{weekday:"short"}),i=t.toLocaleDateString(void 0,{month:"short",day:"numeric"}),n=P(new Date);return e===n?`Today Â· ${o}, ${i}`:`${o}, ${i}`}function K(e){const t=[...new Set((e||[]).filter(Boolean))].sort((d,Y)=>new Date(d).getTime()-new Date(Y).getTime());if(!t.length)return{options:[],defaultDate:""};const o=P(new Date),i=t.filter(d=>d<=o),n=t.filter(d=>d>o),r=t.includes(o)?o:i[i.length-1]??t[0],m=i.slice(-5),G=n.slice(0,5),F=[r,...m.filter(d=>d!==r).reverse(),...G];return{options:[...new Set(F)].slice(0,10),defaultDate:r}}async function q(){a("Loading players..."),C(),h();const e=await w("/api/players"),t=await w("/api/dates?limit=90");if(!Array.isArray(e==null?void 0:e.players))throw new Error("Could not load players from API. Check your Azure Static Web App API configuration and environment variables.");if(!Array.isArray(e==null?void 0:e.activityOptions))throw new Error("Could not load activity options from API.");if(!Array.isArray(t==null?void 0:t.dates))throw new Error("Could not load dates from API.");l.innerHTML="",e.players.forEach((i,n)=>{const r=document.createElement("option");r.value=i.player,r.textContent=i.player,n===0&&(r.selected=!0),l.append(r)}),E.innerHTML="",e.activityOptions.forEach(i=>{const n=document.createElement("option");n.value=i,n.textContent=i,E.append(n)});const o=K(t.dates||[]);if(c.innerHTML="",o.options.forEach((i,n)=>{const r=document.createElement("option");r.value=i,r.textContent=x(i),(i===o.defaultDate||n===0)&&(r.selected=!0),c.append(r)}),!o.options.length){a("No existing date rows were found in the sheet.","error"),u.disabled=!0,l.disabled=!1,c.disabled=!0;return}l.disabled=!1,c.disabled=!1,u.disabled=!1,S(),a("Ready.")}async function z(){var t;C(),h();const e={player:l.value,date:c.value,duration:f.value.trim(),activity:E.value};if(!L(e.duration)){a("Duration must be in hh:mm format, for example 0:36.","error"),S();return}v(!0),a("Submitting...");try{const o=await w("/api/entry",{method:"POST",body:JSON.stringify(e)});M(o.result)}catch(o){o.code==="DATE_ALREADY_POPULATED"&&((t=o.suggestion)!=null&&t.date)?(H({message:o.message,suggestedDate:o.suggestion.date,payload:e}),a(""),h()):(a(o.message,"error"),h())}finally{v(!1),S()}}async function R(){if(!p)return;const e={...p.payload,date:p.suggestedDate};v(!0),a(`Submitting to ${x(e.date)}...`);try{const t=await w("/api/entry",{method:"POST",body:JSON.stringify(e)});W(e.date),M(t.result)}catch(t){a(t.message,"error"),h()}finally{v(!1),S()}}function U(){C(),a("Suggestion dismissed. Choose a different date to continue.","error")}[l,c,f,E].forEach(e=>{e.addEventListener("input",()=>{e===f&&f.value&&!L(f.value)?a("Duration should look like hh:mm, example 0:36."):a(""),S()})});u.addEventListener("click",z);O.addEventListener("click",R);T.addEventListener("click",U);q().catch(e=>{a(e.message,"error")});
